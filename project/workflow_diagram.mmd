graph TB
    %% Styling
    classDef orchestrator fill:#ff9900,stroke:#cc7700,stroke-width:3px,color:#000
    classDef agent fill:#4a90e2,stroke:#2e5c8a,stroke-width:2px,color:#fff
    classDef tool fill:#50c878,stroke:#3a9b5c,stroke-width:2px,color:#000
    classDef llm fill:#9b59b6,stroke:#7d3c98,stroke-width:2px,color:#fff
    classDef db fill:#e74c3c,stroke:#c0392b,stroke-width:2px,color:#fff
    classDef decision fill:#f1c40f,stroke:#d4a017,stroke-width:2px,color:#000
    classDef framework fill:#16a085,stroke:#117a65,stroke-width:3px,color:#fff
    
    %% Customer Request Input
    START([Customer Request<br/>Natural Language]) --> ORCH
    
    %% Orchestrator Agent
    ORCH[üéØ ORCHESTRATOR AGENT<br/>Coordinates all workers]:::orchestrator
    
    %% Step 1: Parsing Agent
    ORCH -->|1. Parse Request| PARSE[üß† PARSING AGENT<br/>LLM-based NLP]:::agent
    PARSE -->|Uses| LLM1[OpenAI GPT-4o-mini]:::llm
    PARSE -->|Extracts| ITEMS[Structured Items:<br/>item_name, quantity]
    
    %% Step 2: Inventory Agent (Framework Agent)
    ITEMS -->|2. Check Availability| INV[üì¶ INVENTORY AGENT<br/>ToolCallingAgent<br/>smolagents Framework]:::framework
    INV -->|Framework Uses Tools| T1["@tool<br/>check_inventory_availability"]:::tool
    INV -->|Framework Uses Tools| T2["@tool<br/>get_inventory_list"]:::tool
    INV -->|Framework Uses Tools| T3["@tool<br/>check_restock_needed"]:::tool
    T1 -->|Calls Helper| H1[get_stock_level]
    T2 -->|Calls Helper| H2[get_all_inventory]
    T3 -->|Calls Helper| H3[get_stock_level]
    H1 & H2 & H3 -->|Query| DB1[(SQLite Database<br/>munder_difflin.db)]:::db
    
    %% Decision: Restock Needed?
    INV -->|Availability Results| DEC1{Items Need<br/>Restocking?}:::decision
    
    %% Step 3: Restocking Agent (Framework Agent)
    DEC1 -->|Yes| REST[üîÑ RESTOCKING AGENT<br/>ToolCallingAgent<br/>smolagents Framework]:::framework
    REST -->|Framework Uses Tools| T4["@tool<br/>restock_item_tool"]:::tool
    REST -->|Framework Uses Tools| T5["@tool<br/>get_supplier_delivery_date_tool"]:::tool
    REST -->|Framework Uses Tools| T6["@tool<br/>get_cash_balance_tool"]:::tool
    T4 -->|Calls Helper| H4[restock_item]
    T5 -->|Calls Helper| H5[get_supplier_delivery_date]
    T6 -->|Calls Helper| H6[get_cash_balance]
    H4 & H6 -->|Query/Update| DB1
    REST -->|Restock Complete| DEC2
    DEC1 -->|No| DEC2
    
    %% Decision: All Items Available?
    DEC2{All Items<br/>Available?}:::decision
    
    %% Step 4: Quoting Agent (Framework Agent)
    DEC2 -->|Yes| QUOTE[üí∞ QUOTING AGENT<br/>ToolCallingAgent<br/>smolagents Framework]:::framework
    DEC2 -->|Some Unavailable| QUOTE
    QUOTE -->|Framework Uses Tools| T7["@tool<br/>calculate_bulk_discount"]:::tool
    QUOTE -->|Framework Uses Tools| T8["@tool<br/>get_item_price"]:::tool
    QUOTE -->|Framework Uses Tools| T9["@tool<br/>generate_quote_tool"]:::tool
    QUOTE -->|Framework Uses Tools| T10["@tool<br/>search_quote_history_tool"]:::tool
    T9 -->|Calls Helper| H7[generate_quote]
    T10 -->|Calls Helper| H8[search_quote_history]
    QUOTE -->|Generate Explanation| LLM2[OpenAI GPT-4o-mini]:::llm
    H7 & H8 -->|Query| DB1
    
    %% Decision: Quote Can Be Fulfilled?
    QUOTE -->|Quote Ready| DEC3{Quote Can Be<br/>Fulfilled?}:::decision
    
    %% Step 5: Ordering Agent (Framework Agent)
    DEC3 -->|Yes - All Available| ORDER[üõí ORDERING AGENT<br/>ToolCallingAgent<br/>smolagents Framework]:::framework
    ORDER -->|Framework Uses Tools| T11["@tool<br/>place_order_tool"]:::tool
    ORDER -->|Framework Uses Tools| T12["@tool<br/>create_transaction_tool"]:::tool
    T11 -->|Calls Helper| H9[place_order]
    T12 -->|Calls Helper| H10[create_transaction]
    H9 & H10 -->|Update Inventory<br/>Record Revenue| DB1
    ORDER -->|Order Complete| RESPONSE1
    
    %% Alternative: Cannot Fulfill
    DEC3 -->|No - Items Unavailable| RESPONSE2[‚ö†Ô∏è Cannot Fulfill Response<br/>With Reasons]
    RESPONSE2 --> FINAL
    
    %% Success Response
    RESPONSE1[‚úÖ Success Response<br/>Professional Quote<br/>Order Confirmation] --> FINAL
    
    %% Final Output
    FINAL([Customer Response<br/>with Details])
    
    %% Framework Integration Note
    subgraph FRAMEWORK_INFO [" "]
        NOTE1["üîß Framework Integration:<br/>All agents are ToolCallingAgent instances<br/>Tools are @tool decorated functions<br/>Framework manages tool invocation"]:::llm
    end
    
    %% Database Helper Functions Used by Tools
    subgraph HELPERS [Helper Functions Called by Tools]
        H1[get_stock_level]
        H2[get_all_inventory]
        H3[get_stock_level]
        H4[restock_item]
        H5[get_supplier_delivery_date]
        H6[get_cash_balance]
        H7[generate_quote]
        H8[search_quote_history]
        H9[place_order]
        H10[create_transaction]
    end
    
    DB1 -.->|Uses| HELPERS
    
    %% Legend
    subgraph LEGEND [Legend]
        L1[üéØ Orchestrator]:::orchestrator
        L2[Agent]:::agent
        L3[Tool @tool]:::tool
        L4[LLM]:::llm
        L5[Database]:::db
        L6{Decision}:::decision
    end
